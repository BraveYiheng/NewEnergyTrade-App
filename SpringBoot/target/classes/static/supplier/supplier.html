<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>供应商主页面</title>
    <link rel="stylesheet" href="../element-ui/lib/theme-chalk/index.css">
    <script src="../js/vue.js"></script>
    <script src="../js/1.7.2axios.js"></script>
    <script src="../element-ui/lib/index.js"></script>
    <style>
        /* 全局样式，用于设置基本布局 */
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
        }
        /* 顶部区域样式 */
        .header {
            background-color: seagreen;
            color: white;
            text-align: center;
            padding: 20px;
            font-size: 35px;
            font-weight: bold;
        }
        .container {
            display: flex;
            min-height: 100vh;
        }


        .sidebar {
            width: 200px;
            background-color: powderblue;
            font-size: 25px;
            padding: 30px;
            border: 1px solid #ccc; /* 添加1px宽的灰色边框 */
            color: black;
            font-weight: 50;
        }

        .sidebar ul li {
            margin-bottom: 20px;
            cursor: pointer;
            transition: all 0.3s ease; /* 添加过渡效果，0.3s的过渡时间，缓动函数为ease，让变化更自然 */
        }
        .sidebar ul li:hover {
            background-color: #cccccc;

        }

        .content {
            flex: 1;
            padding: 20px;
        }

    </style>
</head>

<body>
<div id="app">
    <div class="header">新能源交易平台</div>
    <div class="container">
        <!-- 左侧功能栏 -->
        <div class="sidebar">
            <ul>
                <li @click="showSection('infoManagement')">个人信息</li>
                <li @click="showSection('productManagement')">产品管理</li>
                <li @click="showSection('personalOrder')">我的订单</li>
                <li @click="showSection('evaluation')">交易评价</li>
                <li @click="showSection('feedback')">意见反馈</li>
            </ul>
        </div>
        <!-- 右侧内容区 -->
        <div class="content">
            <!-- 通过v-if来控制不同组件内容的显示 -->
            <div v-if="currentSection === 'infoManagement'">
                <h1 >个人信息管理</h1>
                <el-form :model="userInfo" label-width="80px" class="user-info-form">
                    <el-form-item label="个人姓名:" style="margin-bottom: 15px;">
                        <span>{{ userInfo.contactPerson }}</span>
                    </el-form-item>
                    <el-form-item label="企业名称:" style="margin-bottom: 15px;">
                        <span>{{ userInfo.companyName }}</span>
                    </el-form-item>
                    <el-form-item label="联系方式:" style="margin-bottom: 15px;">
                        <span>{{ userInfo.contactNumber }}</span>
                    </el-form-item>
                    <el-form-item label="邮箱:" style="margin-bottom: 15px;margin-left: -25px">
                        <span>{{ userInfo.email }}</span>
                    </el-form-item>
                    <el-form-item style="display: flex;margin-left: -50px">
                    <el-button type="primary" @click="showEditBasicInfoDialog = true">修改基本信息</el-button>
                    <el-button type="primary" @click="showEditPasswordDialog = true">修改密码</el-button>
                    </el-form-item>
                </el-form>

                <!-- 用于修改基本信息的对话框 -->
                <el-dialog :visible.sync="showEditBasicInfoDialog" title="修改基本信息">
                    <el-form :model="editBasicInfoForm" label-width="120px">
                        <el-form-item label="姓名">
                            <el-input v-model="editBasicInfoForm.contactPerson"></el-input>
                        </el-form-item>
                        <el-form-item label="企业名称">
                            <el-input v-model="editBasicInfoForm.companyName"></el-input>
                        </el-form-item>
                        <el-form-item label="联系方式">
                            <el-input v-model="editBasicInfoForm.contactNumber"></el-input>
                        </el-form-item>
                        <el-form-item label="邮箱">
                            <el-input v-model="editBasicInfoForm.email"></el-input>
                        </el-form-item>
                    </el-form>
                    <span slot="footer" class="dialog-footer">
                        <el-button @click="showEditBasicInfoDialog = false">取消</el-button>
                        <el-button type="primary" @click="saveEditBasicInfo">保存</el-button>
                       </span>
                </el-dialog>

                <!-- 修改密码对话框 -->
                <el-dialog :visible.sync="showEditPasswordDialog" title="修改密码">
                    <el-form :model="passwordForm" label-width="120px">
                        <el-form-item label="原密码">
                            <el-input type="password" v-model="passwordForm.oldPassword"></el-input>
                        </el-form-item>
                        <el-form-item label="新密码">
                            <el-input type="password" v-model="passwordForm.password"></el-input>
                        </el-form-item>
                        <el-form-item label="确认新密码">
                            <el-input type="password" v-model="passwordForm.confirmPassword"></el-input>
                        </el-form-item>
                    </el-form>
                    <span slot="footer" class="dialog-footer">
                <el-button @click="editPasswordDialogVisible = false">取消</el-button>
                <el-button type="primary" @click="updatePassword" :disabled="passwordForm.password!== passwordForm.confirmPassword">保存</el-button>
            </span>
                </el-dialog>
            </div>

            <div v-if="currentSection === 'productManagement'">
                <h1>产品管理</h1>
                <el-tabs v-model="activeTab">
                    <el-tab-pane label="产品类别" name="categoryDisplay">
                        <el-row :gutter="20">    <!--列间隔20-->
                            <el-col :span="6" v-for="category in productCategories" :key="category" v-if="category!='全部'"><!--每列占1/4-->
                                <el-card :title="category">
                                    <el-row >
                                        <el-col :span="24">
                                            <el-image
                                                    :src="getCategoryImage(category)"
                                                    fit="contain" >
                                            </el-image>
                                        </el-col>
                                        <el-col :span="24">
                                            <el-button type="text" @click="showProductDetailsDialog(category)">查看详情</el-button>
                                        </el-col>
                                    </el-row>
                                </el-card>
                            </el-col>
                        </el-row>
                        <!-- 产品详情对话框 -->
                        <el-dialog
                                :visible.sync="productDetailsDialogVisible"
                                title="类别详情"
                                width="400px">
                            <div v-if="currentProductDetails">{{ currentProductDetails.description}}</div>
                            <span slot="footer" class="dialog-footer">
                        <el-button @click="productDetailsDialogVisible = false">关闭</el-button>
                            </span>
                        </el-dialog>
                    </el-tab-pane>
                    <el-tab-pane label="搜索功能" name="searchFunction">
                        <el-form :inline="true" :model="searchForm">
                            <el-form-item label="关键词">
                                <el-input v-model="searchForm.keyword"></el-input>
                            </el-form-item>
                            <el-form-item label="产品类别">
                                <el-select v-model="searchForm.productCategory" @change="searchProducts" clearable placeholder="请选择">
                                    <el-option
                                            v-for="category in productCategories"
                                            :key="category"
                                            :label="category"
                                            :value="category"
                                    ></el-option>
                                </el-select>
                            </el-form-item>
                            <el-form-item label="价格区间">
                                <el-input-number v-model="searchForm.minPrice" :min="0"></el-input-number>
                                <el-input-number v-model="searchForm.maxPrice" :min="0"></el-input-number>
                            </el-form-item>
                            <el-button type="primary" @click="searchProducts">搜索</el-button>
                        </el-form>

                        <el-table :data="searchResults" style="width: 100%">
                            <el-table-column prop="productName" label="产品名称"></el-table-column>
                            <el-table-column prop="productDescription" label="描述"></el-table-column>
                            <el-table-column prop="price" label="价格"></el-table-column>
                            <el-table-column prop="stockQuantity" label="库存数量"></el-table-column>
                        </el-table>
                    </el-tab-pane>
                    <el-tab-pane label="我的产品" name="myProduct">
                        <el-button type="primary"  icon="el-icon-share" @click="openAddDialog">添加产品</el-button>
                        <el-table :data="products" border style="width: 100%">
                            <el-table-column prop="productName" label="产品名称"></el-table-column>
                            <el-table-column prop="productCategory" label="产品类别"></el-table-column>
                            <el-table-column prop="technicalParameters" label="技术参数"></el-table-column>
                            <el-table-column prop="productDescription" label="产品描述"></el-table-column>
                            <el-table-column prop="price" label="价格"></el-table-column>
                            <el-table-column prop="stockQuantity" label="库存数量"></el-table-column>
                            <el-table-column label="操作">
                                <template slot-scope="scope">
                                    <el-button type="primary" icon="el-icon-edit" circle @click="editProduct(scope.row)"></el-button>
                                    <el-button type="danger" icon="el-icon-delete" circle @click="deleteProduct(scope.row.productId)"></el-button>
                                </template>
                            </el-table-column>
                        </el-table>
                        <el-dialog title="添加产品" :visible.sync="addDialogVisible" width="30%">
                            <el-form :model="addProductForm" label-width="120px">
                                <el-form-item label="产品名称">
                                    <el-input v-model="addProductForm.productName"></el-input>
                                </el-form-item>
                                <el-form-item label="产品类别">
                                    <el-select v-model="addProductForm.productCategory" clearable placeholder="请选择">
                                        <el-option
                                                v-for="category in productCategories"
                                                :key="category"
                                                :label="category"
                                                :value="category"
                                        ></el-option>
                                    </el-select>
                                </el-form-item>
                                <el-form-item label="技术参数">
                                    <el-input v-model="addProductForm.technicalParameters"></el-input>
                                </el-form-item>
                                <el-form-item label="产品描述">
                                    <el-input v-model="addProductForm.productDescription"></el-input>
                                </el-form-item>
                                <el-form-item label="价格">
                                    <el-input-number v-model="addProductForm.price" :min="0"></el-input-number>
                                </el-form-item>
                                <el-form-item label="库存数量">
                                    <el-input-number v-model="addProductForm.stockQuantity" :min="0"></el-input-number>
                                </el-form-item>
                            </el-form>
                            <span slot="footer" class="dialog-footer">
                        <el-button @click="addDialogVisible = false">取消</el-button>
                        <el-button type="primary" @click="addProduct">确定</el-button>
                            </span>
                        </el-dialog>
                        <el-dialog title="编辑产品" :visible.sync="editDialogVisible" width="30%">
                            <el-form :model="editProductForm" label-width="120px">
                                <el-form-item label="产品名称">
                                    <el-input v-model="editProductForm.productName"></el-input>
                                </el-form-item>
                                <el-form-item label="产品类别">
                                    <el-select v-model="editProductForm.productCategory" clearable placeholder="请选择">
                                        <el-option
                                                v-for="category in productCategories"
                                                :key="category"
                                                :label="category"
                                                :value="category"
                                        ></el-option>
                                    </el-select>
                                </el-form-item>
                                <el-form-item label="技术参数">
                                    <el-input v-model="editProductForm.technicalParameters"></el-input>
                                </el-form-item>
                                <el-form-item label="产品描述">
                                    <el-input v-model="editProductForm.productDescription"></el-input>
                                </el-form-item>
                                <el-form-item label="价格">
                                    <el-input-number v-model="editProductForm.price" :min="0"></el-input-number>
                                </el-form-item>
                                <el-form-item label="库存数量">
                                    <el-input-number v-model="editProductForm.stockQuantity" :min="0"></el-input-number>
                                </el-form-item>
                            </el-form>
                            <span slot="footer" class="dialog-footer">
                        <el-button @click="editDialogVisible = false">取消</el-button>
                        <el-button type="primary" @click="updateProduct">确定</el-button>
                    </span>
                        </el-dialog>
                    </el-tab-pane>
                </el-tabs>
            </div>

            <div v-if="currentSection === 'personalOrder'">
                <h1>我的订单</h1>
                <!-- 全部订单列表展示相关代码 -->
                <el-tabs v-model="orderActiveTab">
                    <el-tab-pane label="全部订单" name="allOrders">
                   <el-table :data="orders" style="width: 100%">
                       <el-table-column prop="orderNumber" label="订单编号"></el-table-column>
                       <el-table-column prop="product.productName" label="产品名称"></el-table-column>
                       <el-table-column prop="quantity" label="数量"></el-table-column>
                       <el-table-column prop="unitPrice" label="单价"></el-table-column>
                       <el-table-column prop="orderAmount" label="总价格"></el-table-column>
                       <el-table-column label="订单状态">
                           <template #default="scope">
                               <span>{{ getStatusText(scope.row.orderStatus) }}</span>
                           </template>
                       </el-table-column>
                    <el-table-column label="操作">
                        <template #default="scope">
                            <el-button type="text" @click="deleteOrder(scope.row.orderId)">删除</el-button>
                        </template>
                    </el-table-column>
                </el-table>
                  </el-tab-pane>

                        <el-tab-pane label="待发货" name="toDeliver">
                            <!-- 待发货订单列表展示相关代码 -->
                            <el-table :data="toDeliveredOrders" style="width: 100%">
                                <el-table-column prop="orderNumber" label="订单编号"></el-table-column>
                                <el-table-column prop="product.productName" label="产品名称"></el-table-column>
                                <el-table-column prop="quantity" label="数量"></el-table-column>
                                <el-table-column prop="unitPrice" label="单价"></el-table-column>
                                <el-table-column prop="orderAmount" label="总价格"></el-table-column>
                                <el-table-column label="订单状态">
                                    <template #default="scope">
                                        <span>{{ getStatusText(scope.row.orderStatus) }}</span>
                                    </template>
                                </el-table-column>
                                <el-table-column label="操作">
                                    <template #default="scope">
                                        <el-button type="text" @click="deleteOrder(scope.row.orderId)">发货(待完善)</el-button>
                                    </template>
                                </el-table-column>
                            </el-table>
                        </el-tab-pane>

                        <el-tab-pane label="已发货" name="delivered">
                            <!-- 已发货订单列表展示相关代码 -->
                            <el-table :data="deliveredOrders" style="width: 100%">
                                <el-table-column prop="orderNumber" label="订单编号"></el-table-column>
                                <el-table-column prop="product.productName" label="产品名称"></el-table-column>
                                <el-table-column prop="quantity" label="数量"></el-table-column>
                                <el-table-column prop="unitPrice" label="单价"></el-table-column>
                                <el-table-column prop="orderAmount" label="总价格"></el-table-column>
                                <el-table-column label="订单状态">
                                    <template #default="scope">
                                        <span>{{ getStatusText(scope.row.orderStatus) }}</span>
                                    </template>
                                </el-table-column>
                                <el-table-column label="操作">
                                    <template #default="scope">
                                        <el-button type="text" @click="trackOrder(scope.row)">跟踪订单（待完善）</el-button>
                                    </template>
                                </el-table-column>
                            </el-table>
                        </el-tab-pane>
                        <el-tab-pane label="已完成" name="completed">
                            <!-- 已完成订单列表展示相关代码 -->
                            <el-table :data="completedOrders" style="width: 100%">
                                <el-table-column prop="orderNumber" label="订单编号"></el-table-column>
                                <el-table-column prop="product.productName" label="产品名称"></el-table-column>
                                <el-table-column prop="quantity" label="数量"></el-table-column>
                                <el-table-column prop="unitPrice" label="单价"></el-table-column>
                                <el-table-column prop="orderAmount" label="总价格"></el-table-column>
                                <el-table-column label="订单状态">
                                    <template #default="scope">
                                        <span>{{ getStatusText(scope.row.orderStatus) }}</span>
                                    </template>
                                </el-table-column>
                                <el-table-column label="操作">
                                    <template #default="scope">
                                        <el-button type="text" @click="showEvaluationDialog(scope.row)">评价</el-button>
                                    </template>
                                </el-table-column>
                            </el-table>
                            <!-- 评价对话框 -->
                            <el-dialog
                                    title="订单评价"
                                    :visible.sync="evaluationDialogVisible"
                                    width="400px"
                                    @close="resetEvaluationForm">
                                <el-form :model="evaluationForm" label-width="120px">
                                    <el-form-item label="星级评价">
                                        <el-rate v-model="evaluationForm.starRating"></el-rate>
                                    </el-form-item>
                                    <el-form-item label="评价内容">
                                        <el-input v-model="evaluationForm.comment" type="textarea"></el-input>
                                    </el-form-item>
                                    <el-form-item>
                                        <el-button type="primary" @click="submitEvaluation">提交评价</el-button>
                                        <el-button @click="evaluationDialogVisible = false">取消</el-button>
                                    </el-form-item>
                                </el-form>
                            </el-dialog>
                        </el-tab-pane>
                </el-tabs>
            </div>
            <div v-if="currentSection === 'evaluation'">
                <h1>交易评价</h1>
                <!-- 评价展示相关代码 -->
                <el-tabs v-model="evaluationActiveTab">
                    <el-tab-pane label="我写的评价" name="myEvaluation">
                        <el-table :data="myEvaluations" style="width: 100%">
                            <el-table-column prop="orderNumber" label="订单编号"></el-table-column>
                            <el-table-column prop="starRating" label="星级"></el-table-column>
                            <el-table-column prop="comment" label="评价内容"></el-table-column>
                            <el-table-column prop="toUserCompanyName" label="评价的公司"></el-table-column>
                            <el-table-column label="操作">
                                <template #default="scope">
                                    <el-button type="text" @click="deleteEvaluation(scope.row.evaluationId)">删除</el-button>
                                </template>
                            </el-table-column>
                        </el-table>
                    </el-tab-pane>

                    <el-tab-pane label="我收到的评价" name="otherEvaluation">
                        <el-table :data="otherEvaluations" style="width: 100%">
                            <el-table-column prop="orderNumber" label="订单编号"></el-table-column>
                            <el-table-column prop="starRating" label="星级"></el-table-column>
                            <el-table-column prop="comment" label="评价内容"></el-table-column>
                            <el-table-column prop="fromUserCompanyName" label="评价方公司"></el-table-column>
                            <el-table-column prop="createTime" label="评价时间" :formatter="formatDate"></el-table-column>
                            <el-table-column label="操作">
                                <template #default="scope">
                                    <el-button type="text" @click="deleteEvaluation(scope.row.evaluationId)">删除</el-button>
                                </template>
                            </el-table-column>
                        </el-table>
                    </el-tab-pane>
                </el-tabs>
            </div>
            <div v-if="currentSection === 'feedback'">
                <h1>意见反馈</h1>
                <el-form :model="feedbackForm" label-width="120px">
                    <el-form-item label="反馈内容">
                        <div class="input-button-group">
                            <el-input v-model="feedbackForm.content" type="textarea" rows="3" placeholder="请输入您的反馈内容"></el-input>
                            <el-button type="primary" @click="submitFeedback">提交反馈</el-button>
                        </div>
                    </el-form-item>
                </el-form>
                <el-table :data="feedbackRecords" style="width: 100%">
                    <el-table-column type="index" label="序号" width="100"></el-table-column>
                    <el-table-column prop="content" label="反馈内容"></el-table-column>
                        <el-table-column prop="status" label="处理状态"></el-table-column>
                    <el-table-column label="操作">
                        <template #default="scope">
                            <el-button type="text" @click="deleteFeedback(scope.row.feedbackId)">删除</el-button>
                        </template>
                    </el-table-column>
                </el-table>
            </div>

        </div>
    </div>
</div>

<script>
    new Vue({
        el:"#app",
        data() {
            return {
                // 用户管理
                userId:0,
                currentSection: 'productManagement',
                userInfo: null,
                showEditBasicInfoDialog: false,
                showEditPasswordDialog: false,
                editBasicInfoForm: {
                    userId:0,
                    contactPerson: '',
                    companyName: '',
                    contactNumber: '',
                    email: ''
                },
                passwordForm: {
                    userId:0,
                    oldPassword: '',
                    password: '',
                    confirmPassword: ''
                },
                //产品管理
                activeTab: 'categoryDisplay',             //当前展示
                productCategories: ["太阳能","风能","电池"], //产品类别
                productDetailsDialogVisible: false,       // 控制类别详情对话框显示与否
                currentProductDetails: null,              // 用于存储当前点击产品的详情信息

                searchForm: {          //选择类别
                    keyword: '',        //关键字
                    productCategory: '',       //类别
                    minPrice: null,
                    maxPrice: 1000
                },
                searchResults: [],

                products: [],
                addDialogVisible: false,
                editDialogVisible: false,
                addProductForm: {
                    productName: '',
                    productCategory: '',
                    technicalParameters: '',
                    productDescription: '',
                    imagePath:'',
                    price: 0,
                    stockQuantity: 0,
                    supplierId: 0
                },
                editProductForm: {
                    productId:0,  //需要初始化
                    productName: '',
                    productCategory: '',
                    technicalParameters: '',
                    productDescription: '',
                    imagePath:'',
                    price: 0,
                    stockQuantity: 0,
                    supplierId: 0
                },
                // 个人订单
                orderActiveTab:'allOrders',
                orders: [],
                toDeliveredOrders: [],    // 存放待发货订单数据
                deliveredOrders: [],    // 存放已发货订单数据
                completedOrders: [],    // 存放已完成订单数据
                evaluationDialogVisible: false,  // 评价对话框是否显示
                evaluationForm: {
                    evaluationId:0,
                    orderId:0,
                    fromUserId:0,
                    toUserId:0,
                    starRating: 0,
                    comment: '',
                    orderId: null  // 关联评价的订单ID
                },
                //交易评价
                evaluationActiveTab:"myEvaluation",
                myEvaluations: [], // 存放我写的评价数据
                otherEvaluations: [], // 存放其他用户对我的评价数据

                //用户反馈
                feedbackForm: {
                    content: ''
                },
                feedbackRecords: [],
            }
        },
        mounted() {//钩子

            //个人信息
            this.initSetInfo();
            //产品管理
            this.searchAllProducts();//加载搜索所有产品
            this.fetchProducts();// 加载我的产品列表
            this.fetchOrders();//加载我的订单
            this.initEvaluations();//初始化评价
            this.fetchFeedbackRecords();//反馈初始化
        },
        methods: {
            //个人信息
            initSetInfo(){
                const urlParams = new URLSearchParams(window.location.search);
                this.userId = urlParams.get('id');
                axios.get(`/user/${this.userId}`).then((response) => {
                    this.userInfo = response.data;
                    console.log(this.userInfo);
                    this.editBasicInfoForm.userId = this.userInfo.userId;
                    this.editBasicInfoForm.contactPerson = this.userInfo.contactPerson;
                    this.editBasicInfoForm.companyName = this.userInfo.companyName;
                    this.editBasicInfoForm.contactNumber = this.userInfo.contactNumber;
                    this.editBasicInfoForm.email = this.userInfo.email;
                    this.passwordForm.userId = this.userInfo.userId;

                })
                    .catch((error) => {
                        console.error('用户信息获取出错：', error);
                    });
            },
            showSection(section) {
                this.currentSection = section;
            },
            saveEditBasicInfo() {
                console.log(this.editBasicInfoForm);
                axios.put('/user/updateBasicInfo', this.editBasicInfoForm)
                    .then((response) => {
                        if (response.data === "基本信息更新成功") {
                            // 更新本地数据
                            this.userInfo.contactPerson = this.editBasicInfoForm.contactPerson;
                            this.userInfo.companyName = this.editBasicInfoForm.companyName;
                            this.userInfo.contactNumber = this.editBasicInfoForm.contactNumber;
                            this.userInfo.email = this.editBasicInfoForm.email;
                            this.showEditBasicInfoDialog = false;
                        } else {
                            alert('基本信息更新失败，请稍后再试');
                        }
                    })
                    .catch((error) => {
                        console.error(error);
                        alert('更新基本信息出现错误，请稍后再试');
                    });
            },
            updatePassword() {
                if (this.passwordForm.oldPassword!== this.userInfo.password) {
                    alert('输入的原密码不正确，请重新输入');
                    return;
                }
                axios.put('/user/updatePassword', this.passwordForm)
                    .then((response) => {
                        if (response.data === "密码更新成功") {
                            this.userInfo.password = this.passwordForm.password;
                            this.showEditPasswordDialog = false;
                            alert("密码更改成功，请重新登录");
                            setTimeout(() => {
                                window.location.href = '/login.html'
                            }, 2000);
                        } else {
                            alert('密码更新失败，请稍后再试');
                        }
                    })
                    .catch((error) => {
                        console.error(error);
                        alert('更新密码出现错误，请稍后再试');
                    });
            },
            //产品管理
            getCategoryImage(category) {
                const imageMap = {
                    风能: '../images/solarPanel.jpg',
                    太阳能: '../images/windBlade.jpg',
                    电池: '../images/battery.jpg',
                };
                return imageMap[category];
            },//产品类别
            showProductDetailsDialog(category) {
                // 根据不同类别设置模拟的产品详情描述
                const detailsMap = {
                    风能: {
                        description: '风能设备是一种利用风能转化为电能的装置，具有环保、可再生等优点，广泛应用于风力发电场等场景。',
                    },
                    太阳能: {
                        description: '太阳能设备主要通过吸收太阳光能转化为电能，包括太阳能板等组件，常见于屋顶太阳能电站等地方，无污染且可持续提供能源。',
                    },
                    电池: {
                        description: '电池作为储能设备，可存储电能以供后续使用，在新能源领域常用于配合风能、太阳能设备，保障电能的稳定供应，有多种类型和规格。',
                    },
                };
                this.currentProductDetails = detailsMap[category];
                this.productDetailsDialogVisible = true;
            },
            searchAllProducts(){
                axios.get('/product/all') //获取所有产品
                    .then((response) => {
                        this.searchResults = response.data;
                    })
                    .catch((error) => {
                        console.error('搜索产品出错：', error);
                    });
            },
            searchProducts() {
                axios.post('/product/search', this.searchForm)
                    .then((response) => {
                        this.searchResults = response.data;
                    })
                    .catch((error) => {
                        console.error('搜索产品出错：', error);
                    });
            },
            handleAddDialogClose() {
                this.$refs.addProductForm.resetFields();
            },// 处理添加产品对话框关闭前的操作（比如重置表单验证状态等）
            handleEditDialogClose() {
                this.$refs.editProductForm.resetFields();
            }, // 处理编辑产品对话框关闭前的操作
            fetchProducts() {                 //我的产品
                // 这里假设通过axios根据当前用户ID获取产品列表，需要完善获取用户ID的逻辑
                const userId = this.userId; // 示例用户ID，实际中要替换
                axios.get(`/product/user/${userId}`)
                    .then(response => {
                        this.products = response.data;
                    })
                    .catch(error => {
                        console.error('获取产品列表失败', error);
                    });
            },//根据用户id获取产品
            openAddDialog() {
                this.addProductForm = {
                    productName: '',
                    productCategory: '',
                    technicalParameters: '',
                    productDescription: '',
                    imagePath:'',
                    price: 0,
                    stockQuantity: 0,
                    supplierId: this.userId
                };
                this.addDialogVisible = true;
            },
            addProduct(){
                        axios.post('/product/add', this.addProductForm)
                            .then(response => {
                                if (response.data) {
                                    this.addDialogVisible = false;
                                    this.fetchProducts();
                                    // 可以添加成功提示信息，比如使用Element UI的消息提示组件
                                    this.$message({
                                        type: 'success',
                                        message: '产品添加成功'
                                    });
                                } else {
                                    // 添加失败提示
                                    this.$message({
                                        type: 'error',
                                        message: '产品添加失败，请稍后再试'
                                    });
                                }
                            })
                            .catch(error => {
                                console.error('添加产品失败', error);
                                // 也可以在这里弹出更详细的错误提示给用户，比如网络异常等情况
                                this.$message({
                                    type: 'error',
                                    message: '网络异常，添加产品操作未能完成，请检查网络连接后重试'
                                });
                            });
                    },
            editProduct(product) {
                // 填充编辑产品的表单数据
                this.editProductForm = {...product };
                console.log(this.editProductForm);
                this.editDialogVisible = true;
            },
            updateProduct() {
                        axios.put('/product/update', this.editProductForm)
                            .then(response => {
                                if (response.data) {
                                    this.editDialogVisible = false;
                                    this.fetchProducts();
                                    // 可以添加成功提示信息，比如使用Element UI的消息提示组件
                                    this.$message({
                                        type: 'success',
                                        message: '产品更新成功'
                                    });
                                } else {
                                    // 添加失败提示
                                    this.$message({
                                        type: 'error',
                                        message: '产品更新失败，请稍后再试'
                                    });
                                }
                            })
                            .catch(error => {
                                console.error('更新产品失败', error);
                                this.$message({
                                    type: 'error',
                                    message: '网络异常，更新产品操作未能完成，请检查网络连接后重试'
                                });
                            });
                    },
            deleteProduct(productId) {
                this.$confirm('是否确定删除该产品?', '提示', {
                    confirmButtonText: '确定',
                    cancelButtonText: '取消',
                    type: 'warning'
                }).then(() => {
                    axios.delete(`/product/${productId}`)
                        .then(() => {
                            this.fetchProducts();//更新
                        })
                        .catch(error => {
                            console.error('删除产品失败', error);
                        });
                }).catch(() => {
                    // 用户取消删除操作
                });
            },
            //我的订单
            // 假设从后端获取所有订单数据的方法，这里简单模拟数据分类填充到对应数组
            fetchOrders() {
                const userId = this.userId;
                // 初始化这几个数组
                this.toDeliveredOrders = [];
                this.deliveredOrders = [];
                this.completedOrders = [];
                axios.get(`/order/user/${userId}`).then((response) => {
                    this.orders = response.data;
                    this.orders.forEach(order => {
                        switch (order.orderStatus) {
                            case 2:
                                // 将符合状态的订单数据添加到对应的数组中
                                this.toDeliveredOrders.push(order);
                                break;
                            case 3:
                                this.deliveredOrders.push(order);
                                break;
                            case 4:
                                this.completedOrders.push(order);
                                break;
                        }
                    });
                })
                    .catch((error) => {
                        console.error(error);
                        alert('获取订单出现错误，请稍后再试');
                    });
            },
            getStatusText(statusCode) {
                switch (statusCode) {
                    case 0:
                        return "待付款";
                    case 1:
                        return "已付款";
                    case 2:
                        return "待发货";
                    case 3:
                        return "已发货";
                    case 4:
                        return "已完成";
                    default:
                        return "未知状态";
                }
            },  //订单状态
            deleteOrder(orderId){
                this.$confirm('是否确定删除该订单?', '提示', {
                    confirmButtonText: '确定',
                    cancelButtonText: '取消',
                    type: 'warning'
                }).then(() => {
                    axios.delete(`/order/${orderId}`)
                        .then(() => {
                            this.fetchOrders();//更新
                        })
                        .catch(error => {
                            console.error('删除订单失败', error);
                        });
                }).catch(() => {
                    // 用户取消删除操作
                });
            },
            trackOrder(order) {
                // 处理跟踪订单逻辑，比如跳转到物流页面等
            }, //待完成
            showEvaluationDialog(order) {
                // 显示评价对话框，并设置关联的订单ID等信息
                this.evaluationForm.orderId = order.orderId;
                this.evaluationForm.fromUserId = this.userId
                this.evaluationForm.toUserId = order.purchaserId;
                this.evaluationDialogVisible = true;
            },
            submitEvaluation() {
                // 这里需要将评价数据发送到后端，假设通过axios发送
                const evaluationData = this.evaluationForm;
                axios.post('/evaluation/submit', evaluationData).then(response => {
                    // 成功提交评价后，更新相关数据，比如将已完成订单的评价状态更新
                    this.fetchOrders();  // 重新获取订单数据，更新各状态订单列表及评价状态
                    this.evaluationDialogVisible = false;
                    this.resetEvaluationForm();
                }).catch(error => {
                    console.error('提交评价失败', error);
                });
            },
            resetEvaluationForm() {
                // 重置评价表单数据
                this.evaluationForm = {
                    starRating: 0,
                    comment: '',
                    orderId: null,
                    toUserId: null,
                };
            },
            //订单评价
            formatDate(row, column, cellValue, index) {
                if (cellValue) {
                    const date = new Date(cellValue);
                    const year = date.getFullYear();
                    const month = String(date.getMonth() + 1).padStart(2, '0');
                    const day = String(date.getDate()).padStart(2, '0');
                    const hours = String(date.getHours()).padStart(2, '0');
                    const minutes = String(date.getMinutes()).padStart(2, '0');
                    const seconds = String(date.getSeconds()).padStart(2, '0');
                    return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
                }
                return '';
            },
            fetchMyEvaluations() {
                const  id= this.userId;
                axios.get(`/evaluation/fromUser/${id}`).then(response => {
                    this.myEvaluations = response.data;
                }).catch(error => {
                    console.error('获取我写的评价数据失败', error);
                });
            },
            fetchOtherEvaluations() {
                const  id= this.userId;
                axios.get(`/evaluation/toUser/${id}`).then(response => {
                    this.otherEvaluations = response.data;
                }).catch(error => {
                    console.error('获取其他用户对我的评价数据失败', error);
                });
            },
            initEvaluations() {
                this.fetchMyEvaluations();
                this.fetchOtherEvaluations();
            },
            deleteEvaluation(evaluationId){
                this.$confirm('是否确定删除该评论?', '提示', {
                    confirmButtonText: '确定',
                    cancelButtonText: '取消',
                    type: 'warning'
                }).then(() => {
                    axios.delete(`/evaluation/${evaluationId}`)
                        .then(() => {
                            this.initEvaluations();
                        })
                        .catch(error => {
                            console.error('删除评论失败', error);
                        });
                }).catch(() => {
                    // 用户取消删除操作
                });
            },
            //反馈模块
            submitFeedback() {
                // 先进行简单的输入内容验证，这里仅判断是否为空字符串，实际可根据需求添加更复杂验证逻辑
                if (!this.feedbackForm.content.trim()) {
                    this.$message({
                        message: '反馈内容不能为空，请填写后再提交',
                        type: 'warning'
                    });
                    return;
                }
                const feedback = {
                    content: this.feedbackForm.content,
                    userId: this.userId
                };
                axios.post('/feedback/add', feedback).then(response => {
                    if (response.data) {
                        // 提交成功后清空输入框内容
                        this.feedbackForm.content = '';
                        // 重新获取反馈记录，更新表格展示数据
                        this.fetchFeedbackRecords();
                        this.$message({
                            message: '反馈提交成功',
                            type: 'success'
                        });
                    } else {
                        this.$message.error('反馈提交失败，请稍后再试');
                    }
                }).catch(error => {
                    console.error('反馈提交出错', error);
                    this.$message.error('反馈提交出现系统错误，请联系管理员');
                });
            },
            fetchFeedbackRecords() {
                axios.get(`/feedback/user/${this.userId}`).then(response => {
                    this.feedbackRecords = response.data;
                }).catch(error => {
                    console.error('获取反馈记录出错', error);
                    this.$message.error('获取反馈记录出现问题，请稍后再试');
                });
            },
            deleteFeedback(feedbackId){
                this.$confirm('是否确定删除?', '提示', {
                    confirmButtonText: '确定',
                    cancelButtonText: '取消',
                    type: 'warning'
                }).then(() => {
                    axios.delete(`/feedback/${feedbackId}`)
                        .then(() => {
                            this.fetchFeedbackRecords();
                        })
                        .catch(error => {
                            console.error('删除失败', error);
                        });
                }).catch(() => {
                    // 用户取消删除操作
                });
            }


        }
    });
</script>

</body>
</html>